<!-- AIç”Ÿæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<section id="generate-section" style="margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
  <h2>ğŸ¬ æ–°ã—ã„ãƒ“ãƒ‡ã‚ªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆ</h2>
  
  <div id="generate-form">
    <div style="margin-bottom: 15px;">
      <label for="framework">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é¸æŠ:</label>
      <select id="framework" required style="width: 100%; padding: 8px;">
        <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
        <option value="threeAct">Three-Act Structure (3æ®µéšæ§‹æˆ)</option>
        <option value="cams">CAMS (å…±æ„Ÿãƒ»è¨´æ±‚ãƒ»å‹•æ©Ÿãƒ»è¡Œå‹•)</option>
        <option value="abcd">ABCD (èˆˆå‘³ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»æ„Ÿæƒ…ãƒ»è¡Œå‹•)</option>
        <option value="prep">PREP Method (çµè«–ãƒ»ç†ç”±ãƒ»ä¾‹ãƒ»å†çµè«–)</option>
        <option value="problemSolution">Problem-Solution (å•é¡Œãƒ»è§£æ±º)</option>
        <option value="customerJourney">Customer Journey (é¡§å®¢ã®æ—…)</option>
      </select>
    </div>

    <div style="margin-bottom: 15px;">
      <label for="duration">å‹•ç”»ã®é•·ã• (åˆ†):</label>
      <input type="number" id="duration" min="1" max="10" value="2" required style="width: 100%; padding: 8px;">
    </div>

    <div style="margin-bottom: 15px;">
      <label for="style">ã‚¹ã‚¿ã‚¤ãƒ«:</label>
      <select id="style" required style="width: 100%; padding: 8px;">
        <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
        <option value="professional">Professional (ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«)</option>
        <option value="casual">Casual (ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«)</option>
        <option value="educational">Educational (æ•™è‚²çš„)</option>
        <option value="entertaining">Entertaining (ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ‹ãƒ³ã‚°)</option>
      </select>
    </div>

    <div style="margin-bottom: 15px;">
      <label for="tone">ãƒˆãƒ¼ãƒ³:</label>
      <select id="tone" required style="width: 100%; padding: 8px;">
        <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
        <option value="formal">Formal (ãƒ•ã‚©ãƒ¼ãƒãƒ«)</option>
        <option value="friendly">Friendly (ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼)</option>
        <option value="persuasive">Persuasive (èª¬å¾—çš„)</option>
        <option value="informative">Informative (æƒ…å ±çš„)</option>
      </select>
    </div>

    <div style="margin-bottom: 15px;">
      <label for="title">ã‚¿ã‚¤ãƒˆãƒ« (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
      <input type="text" id="title" placeholder="ä¾‹: æ–°è£½å“ç´¹ä»‹ãƒ“ãƒ‡ã‚ª" style="width: 100%; padding: 8px;">
    </div>

    <button id="generate-btn" style="width: 100%; padding: 12px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold;">
      AIç”Ÿæˆã‚’é–‹å§‹
    </button>
  </div>

  <div id="generate-result" style="margin-top: 20px; display: none;">
    <h3>ç”Ÿæˆçµæœ:</h3>
    <pre id="result-content" style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto;"></pre>
  </div>

  <div id="generate-error" style="margin-top: 20px; display: none; color: red;">
    <p id="error-content"></p>
  </div>

  <div id="generate-loading" style="margin-top: 20px; display: none; text-align: center;">
    <p>â³ AIç”Ÿæˆä¸­...</p>
    <progress id="progress-bar" style="width: 100%;"></progress>
  </div>
</section>

<script>
  // API ãƒ™ãƒ¼ã‚¹ URL
  const API_BASE = 'https://videoscript-ai.totalgraphicarts.workers.dev';

  // AIç”Ÿæˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
  document.getElementById('generate-btn').addEventListener('click', async () => {
    const framework = document.getElementById('framework').value;
    const duration = document.getElementById('duration').value;
    const style = document.getElementById('style').value;
    const tone = document.getElementById('tone').value;
    const title = document.getElementById('title').value;

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (!framework || !duration || !style || !tone) {
      alert('ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    document.getElementById('generate-loading').style.display = 'block';
    document.getElementById('generate-result').style.display = 'none';
    document.getElementById('generate-error').style.display = 'none';

    try {
      // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      const token = localStorage.getItem('token');
      if (!token) {
        throw new Error('èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
      }

      // API ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
      const response = await fetch(`${API_BASE}/api/generate`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`,
        },
        body: JSON.stringify({
          framework,
          duration: parseInt(duration),
          style,
          tone,
          title: title || undefined,
        }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'AIç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }

      // çµæœè¡¨ç¤º
      document.getElementById('generate-loading').style.display = 'none';
      document.getElementById('generate-result').style.display = 'block';
      document.getElementById('result-content').textContent = JSON.stringify(data, null, 2);

      // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆæ›´æ–°
      location.reload(); // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚’æ›´æ–°

    } catch (error) {
      console.error('Error:', error);
      document.getElementById('generate-loading').style.display = 'none';
      document.getElementById('generate-error').style.display = 'block';
      document.getElementById('error-content').textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
    }
  });
</script>
